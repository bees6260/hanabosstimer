<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>哈娜RO Boss計時器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            margin-right: 320px;
            /* 為右側事件列表預留空間 */
        }

        /* 右側事件列表樣式 */
        #eventLog {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100vh;
            background: #333;
            color: white;
            padding: 10px;
            z-index: 100;
            overflow-y: auto;
        }

        .log-item {
            display: flex;
            flex-direction: column;
            /* 確保垂直堆疊 */
            margin: 5px 0;
            padding: 10px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .log-info {
            display: flex;
            align-items: center;
            gap: 5px;
            /* 調整「倒數:」與倒數時間的間距 */
        }

        .log-content {
            font-size: 14px;
            line-height: 1.5;
        }

        .timer {
            color: #ff4444;
            font-weight: bold;
        }

        .cancel-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 4px 8px;
            /* 減少內邊距 */
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            /* 減少字體大小 */
            max-width: 70px;
            /* 設定最大寬度 */
            width: auto;
            /* 讓按鈕寬度自動調整 */
            white-space: nowrap;
            /* 防止按鈕文字換行 */
        }

        .cancel-btn:hover {
            background: #ff6666;
        }

        /* 搜尋框樣式 */
        .search-container {
            background: #fff;
            padding: 10px;
            z-index: 99;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            /* 調整間距 */
        }

        #searchInput {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        /* 頁面標題樣式 */
        .page-title {
            text-align: center;
            margin: 20px 0;
        }

        .page-title h1 {
            margin: 0;
            padding: 10px;
            color: #333;
            font-size: 24px;
        }

        /* 主容器樣式 */
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            /* 固定間距 */
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            width: 320px;
            /* 增加寬度以容納圖片和按鈕 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s;
            /* 添加過渡效果 */
        }

        .card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.02);
        }

        .card-header {
            margin-bottom: 10px;
        }

        .card-header h3 {
            margin: 0;
            font-size: 18px;
            text-align: center;
        }

        .card-body {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .boss-image {
            width: 120px;
            /* 增加圖片寬度 */
            height: 120px;
            /* 增加圖片高度 */
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            /* 減少按鈕間距 */
            flex-grow: 1;
            /* 讓按鈕區域填滿剩餘空間 */
            max-width: 160px;
            /* 設定控制區域的最大寬度 */
        }

        .controls button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 6px 10px;
            /* 減少內邊距 */
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            /* 減少字體大小 */
            text-align: center;
            max-width: 140px;
            /* 設定按鈕的最大寬度 */
            width: auto;
            /* 讓按鈕寬度自動調整 */
            white-space: nowrap;
            /* 防止按鈕文字換行 */
        }

        .controls button:hover {
            background: #45a049;
        }

        input[type="datetime-local"],
        input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        /* 對話框樣式 */
        .input-time-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        /* 新增的倒數時間對話框樣式 */
        #countdownDialog label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #333;
        }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore.js";

        // 在此填入您的 Firebase 設定
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "ro-boss-timer.firebaseapp.com",
            projectId: "ro-boss-timer",
            storageBucket: "ro-boss-timer.appspot.com",
            messagingSenderId: "743569692128",
            appId: "1:743569692128:web:92c439c1c58a9c6801c785",
            measurementId: "G-T39L35DDV0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const bosses = [
            { category: "MVP", name: "1039 巴風特", respawnTime: 3600000, imageUrl: "/images/1039_BAPHOMET.gif" },
            { category: "MVP", name: "1046 死靈(吉分)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1046" },
            { category: "MVP", name: "1046 死靈(地下)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1046" },
            { category: "MVP", name: "1059 蜂后", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1059" },
            { category: "MVP", name: "1086 黃金蟲", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1086" },
            { category: "MVP", name: "1087 獸人英雄1", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1087" },
            { category: "MVP", name: "1087 獸人英雄2", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1087" },
            { category: "MVP", name: "1112 海盜之王", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1112" },
            { category: "MVP", name: "1115 虎王", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1115" },
            { category: "MVP", name: "1147 蟻后", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1147" },
            { category: "MVP", name: "1150 月夜貓", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1150" },
            { category: "MVP", name: "1157 法老王", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1157" },
            { category: "MVP", name: "1159 皮里恩", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1159" },
            { category: "MVP", name: "1181 殭屍龍", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1181" },
            { category: "MVP", name: "1190 獸人酋長", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1190" },
            { category: "MVP", name: "1251 冰暴騎士", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1251" },
            { category: "MVP", name: "1252 卡崙", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1252" },
            { category: "MVP", name: "1272 黑暗之王(古墓)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1272" },
            { category: "MVP", name: "1272 黑暗之王(地下)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1272" },
            { category: "MVP", name: "1289 狂暴蟻后", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1289" },
            { category: "MVP", name: "1312 烏龜將軍", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1312" },
            { category: "MVP", name: "1373 死靈騎士", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1373" },
            { category: "MVP", name: "1389 德古拉男爵", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1389" },
            { category: "MVP", name: "1418 墨蛇君", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1418" },
            { category: "MVP", name: "1492 元靈武士", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1492" },
            { category: "MVP", name: "1511 古埃及王", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1511" },
            { category: "MVP", name: "1518 白素貞", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1518" },
            { category: "MVP", name: "1583 塔奧群卡", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1583" },
            { category: "MVP", name: "1623 RSX-0806", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1623" },
            { category: "MVP", name: "1685 貝思波", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1685" },
            { category: "MVP", name: "1688 嗒妮小姐", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1688" },
            { category: "MVP", name: "1708 魔劍士達納托斯的記憶", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1708" },
            { category: "MVP", name: "1719 迪塔勒泰晤勒斯", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1719" },
            { category: "MVP", name: "1734 齊爾-D-01", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1734" },
            { category: "MVP", name: "1768 幽暗夢魘", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1768" },
            { category: "MVP", name: "1871 墮落大神官悉潘", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1871" },
            { category: "MVP", name: "1873 貝雷傑", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1873" },
            { category: "MVP", name: "1874 詛咒蠅王", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1874" },
            { category: "波利家族", name: "1096 天波(朱原3)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1096" },
            { category: "波利家族", name: "1096 天波(斐原4)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1096" },
            { category: "波利家族", name: "1120 幽波(沉船2)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1120" },
            { category: "波利家族", name: "1120 幽波(迷藏3)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1120" },
            { category: "波利家族", name: "1120 幽波(斐原4)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1120" },
            { category: "波利家族", name: "1120 幽波(公會4)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1120" },
            { category: "波利家族", name: "1388 聖天波(朱原5)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1388" },
            { category: "波利家族", name: "1582 惡波(斐原4)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1582" },
            { category: "波利家族", name: "1582 惡波(朱原3)", respawnTime: 3600000, imageUrl: "https://via.placeholder.com/120?text=1582" }
        ];

        let bossTimers = [];
        let currentBossIndex = null;
        let currentBossIndexForCountdown = null;

        // 格式化重生時間為 MM/DD 上午/下午 HH:MM:SS
        function formatRespawnTime(date) {
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');

            let hours = date.getHours();
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            const period = hours >= 12 ? '下午' : '上午';

            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            // 移除小時的前導零
            hours = String(hours);

            return `${month}/${day} ${period} ${hours}:${minutes}:${seconds}`;
        }

        // 格式化倒數時間為 HH:MM:SS
        function formatCountdown(timeLeft) {
            const totalSeconds = Math.floor(timeLeft / 1000);
            const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        async function loadEventsFromFirebase() {
            // 使用orderBy來排序重生時間
            const q = query(collection(db, 'bossEvents'), orderBy('respawnTime', 'asc'));
            const snapshot = await getDocs(q);
            snapshot.forEach(docSnap => {
                const data = docSnap.data();
                const bossIndex = bosses.findIndex(b => b.name === data.bossName);
                if (bossIndex !== -1) {
                    const respawnTime = new Date(data.respawnTime);
                    addToEventLog(data.bossName, respawnTime, docSnap.id);
                    startTimer(bossIndex, respawnTime, docSnap.id);
                }
            });
        }

        function generateCards() {
            const mvpContainer = document.querySelector('.mvp-section .cards-container');
            const poringContainer = document.querySelector('.poring-section .cards-container');

            bosses.forEach((boss, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        <h3>${boss.name}</h3>
                    </div>
                    <div class="card-body">
                        <img src="${boss.imageUrl}" alt="Boss Image" class="boss-image">
                        <div class="controls">
                            <button onclick="recordKill(${index})">記錄擊殺</button>
                            <button onclick="openTimeDialog(${index})">輸入擊殺時間</button>
                            <button onclick="openCountdownDialog(${index})">輸入雷達時間</button>
                        </div>
                    </div>
                `;

                if (boss.category === "MVP") {
                    mvpContainer.appendChild(card);
                } else {
                    poringContainer.appendChild(card);
                }
            });
        }

        // 打開輸入擊殺時間對話框
        window.openTimeDialog = function (bossIndex) {
            currentBossIndex = bossIndex;
            const dialog = document.getElementById('timeDialog');
            const overlay = document.getElementById('overlay');
            const dialogBossName = document.getElementById('dialogBossName');
            const dialogTimeInput = document.getElementById('dialogTimeInput');

            dialogBossName.textContent = bosses[bossIndex].name;

            // 使用本地時間格式化為 datetime-local 所需格式
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');

            const timeString = `${year}-${month}-${day}T${hours}:${minutes}`;
            dialogTimeInput.value = timeString;

            dialog.style.display = 'block';
            overlay.style.display = 'block';
        };

        // 關閉輸入擊殺時間對話框
        window.closeTimeDialog = function () {
            const dialog = document.getElementById('timeDialog');
            const overlay = document.getElementById('overlay');
            dialog.style.display = 'none';
            overlay.style.display = 'none';
            currentBossIndex = null;
        };

        // 確認自訂時間並更新事件
        window.confirmCustomTime = async function () {
            const timeInput = document.getElementById('dialogTimeInput');
            const customDate = new Date(timeInput.value);
            if (currentBossIndex !== null) {
                await updateBossTimer(currentBossIndex, customDate);
            }
            closeTimeDialog();
        }

        // 記錄擊殺時間
        window.recordKill = async function (bossIndex) {
            const now = new Date();
            await updateBossTimer(bossIndex, now);
        }

        // 更新Boss計時器
        async function updateBossTimer(bossIndex, killTime) {
            const boss = bosses[bossIndex];
            const respawnTime = new Date(killTime.getTime() + boss.respawnTime);

            const docRef = await addDoc(collection(db, 'bossEvents'), {
                bossName: boss.name,
                killTime: killTime.toISOString(),
                respawnTime: respawnTime.toISOString()
            });

            addToEventLog(boss.name, respawnTime, docRef.id);
            startTimer(bossIndex, respawnTime, docRef.id);
        }

        // 開啟倒數時間對話框
        window.openCountdownDialog = function (bossIndex) {
            currentBossIndexForCountdown = bossIndex;
            const dialog = document.getElementById('countdownDialog');
            const overlay = document.getElementById('overlay');
            const dialogBossName = document.getElementById('countdownDialogBossName');
            const countdownInput = document.getElementById('countdownInput');

            dialogBossName.textContent = bosses[bossIndex].name;
            countdownInput.value = 30; // 預設30分鐘

            dialog.style.display = 'block';
            overlay.style.display = 'block';
        };

        // 關閉倒數時間對話框
        window.closeCountdownDialog = function () {
            const dialog = document.getElementById('countdownDialog');
            const overlay = document.getElementById('overlay');
            dialog.style.display = 'none';
            overlay.style.display = 'none';
            currentBossIndexForCountdown = null;
        };

        // 確認倒數時間並更新事件
        window.confirmCountdown = async function () {
            const countdownInput = document.getElementById('countdownInput');
            const minutes = parseInt(countdownInput.value, 10);
            if (currentBossIndexForCountdown !== null && minutes > 0) {
                const boss = bosses[currentBossIndexForCountdown];
                const now = new Date();
                // respawnTime = 現在時間 + 使用者輸入的分鐘數
                const respawnTime = new Date(now.getTime() + minutes * 60 * 1000);
                // killTime = respawnTime - boss預設respawnTime
                const killTime = new Date(respawnTime.getTime() - boss.respawnTime);

                await updateBossTimerByRespawn(currentBossIndexForCountdown, killTime, respawnTime);
            }
            closeCountdownDialog();
        };

        // 根據已知的擊殺時間和重生時間更新Boss計時器
        async function updateBossTimerByRespawn(bossIndex, killTime, respawnTime) {
            const boss = bosses[bossIndex];
            const docRef = await addDoc(collection(db, 'bossEvents'), {
                bossName: boss.name,
                killTime: killTime.toISOString(),
                respawnTime: respawnTime.toISOString()
            });

            addToEventLog(boss.name, respawnTime, docRef.id);
            startTimer(bossIndex, respawnTime, docRef.id);
        }

        // 啟動倒數計時器
        function startTimer(bossIndex, respawnTime, docId) {
            if (bossTimers[bossIndex]) {
                clearInterval(bossTimers[bossIndex]);
            }

            bossTimers[bossIndex] = setInterval(() => {
                const now = new Date();
                const timeLeft = respawnTime - now;

                if (timeLeft <= 0) {
                    clearInterval(bossTimers[bossIndex]);
                    updateEventLogTimer(bosses[bossIndex].name, "已重生!");
                } else {
                    const formattedCountdown = formatCountdown(timeLeft);
                    updateEventLogTimer(bosses[bossIndex].name, formattedCountdown);
                }
            }, 1000);
        }

        // 添加事件到事件列表
        function addToEventLog(bossName, respawnTime, docId) {
            const logDiv = document.getElementById('eventLogContent');
            const logId = `log-${bossName.replace(/[^a-zA-Z0-9]/g, '')}`;
            const logItem = document.createElement('div');
            logItem.id = logId;
            logItem.className = 'log-item';
            logItem.setAttribute('data-doc-id', docId);

            // 格式化重生時間
            const formattedRespawn = formatRespawnTime(respawnTime);

            // 設定倒數計時器的初始顯示
            const initialCountdown = "計算中...";

            // 調整顯示格式：取消鍵在同一行，縮短「倒數:」與倒數時間的距離
            logItem.innerHTML = `
                <div class="log-header">
                    <div class="log-info">
                        ${bossName} | 倒數:<span class="timer">${initialCountdown}</span>
                    </div>
                    <button class="cancel-btn" onclick="cancelEvent('${logId}')">取消</button>
                </div>
                <div class="log-content">
                    重生: ${formattedRespawn}
                </div>
            `;

            // 如果事件已存在，先移除再插入以保持排序
            const existingLog = document.getElementById(logId);
            if (existingLog) {
                logDiv.removeChild(existingLog);
            }

            // 將新的事件插入到正確的位置以保持排序
            let inserted = false;
            const allLogs = Array.from(logDiv.children);
            for (let i = 0; i < allLogs.length; i++) {
                const existingRespawnText = allLogs[i].querySelector('.log-content')?.textContent || "";
                const existingRespawnDateMatch = existingRespawnText.match(/重生: (\d{2})\/(\d{2}) (\S+) (\d{1,2}):(\d{2}):(\d{2})/);
                if (existingRespawnDateMatch) {
                    const month = parseInt(existingRespawnDateMatch[1], 10);
                    const day = parseInt(existingRespawnDateMatch[2], 10);
                    const period = existingRespawnDateMatch[3];
                    let hours = parseInt(existingRespawnDateMatch[4], 10);
                    const minutes = parseInt(existingRespawnDateMatch[5], 10);
                    const seconds = parseInt(existingRespawnDateMatch[6], 10);

                    // 轉換為24小時制
                    if (period === '下午' && hours !== 12) hours += 12;
                    if (period === '上午' && hours === 12) hours = 0;

                    const existingRespawnDate = new Date();
                    existingRespawnDate.setMonth(month - 1);
                    existingRespawnDate.setDate(day);
                    existingRespawnDate.setHours(hours);
                    existingRespawnDate.setMinutes(minutes);
                    existingRespawnDate.setSeconds(seconds);
                    existingRespawnDate.setMilliseconds(0);

                    if (respawnTime < existingRespawnDate) {
                        logDiv.insertBefore(logItem, allLogs[i]);
                        inserted = true;
                        break;
                    }
                }
            }

            if (!inserted) {
                logDiv.appendChild(logItem);
            }
        }

        // 取消事件
        window.cancelEvent = async function (logId) {
            const logItem = document.getElementById(logId);
            if (logItem) {
                const docId = logItem.getAttribute('data-doc-id');
                await deleteDoc(doc(db, 'bossEvents', docId));

                logItem.remove();
                const bossName = logId.replace(/^log-/, '');
                const bossIndex = bosses.findIndex(b => b.name.replace(/[^a-zA-Z0-9]/g, '') === bossName);

                if (bossIndex >= 0 && bossTimers[bossIndex]) {
                    clearInterval(bossTimers[bossIndex]);
                    bossTimers[bossIndex] = null;
                }
            }
        }

        // 複製所有事件到剪貼簿，只複製Boss名和重生時間
        window.copyAllEvents = function () {
            const logContent = document.getElementById('eventLogContent');
            let textToCopy = '';
            const logItems = logContent.getElementsByClassName('log-item');

            for (const item of logItems) {
                const bossName = item.querySelector('.log-info').textContent.split(' | ')[0].trim();
                const respawnText = item.querySelector('.log-content').textContent.replace('重生: ', '').trim();
                textToCopy += `${bossName}\n重生: ${respawnText}\n\n`;
            }

            if (textToCopy) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    alert('已複製所有事件到剪貼簿');
                }).catch(err => {
                    console.error('複製失敗:', err);
                    const textarea = document.createElement('textarea');
                    textarea.value = textToCopy;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert('已複製所有事件到剪貼簿');
                });
            } else {
                alert('沒有可複製的事件');
            }
        }

        // 更新倒數計時器顯示
        function updateEventLogTimer(bossName, timeString) {
            const logId = `log-${bossName.replace(/[^a-zA-Z0-9]/g, '')}`;
            const logItem = document.getElementById(logId);
            if (logItem) {
                const timerSpan = logItem.querySelector('.timer');
                if (timerSpan) {
                    timerSpan.textContent = `${timeString}`;
                }
            }
        }

        // 初始化頁面
        window.onload = async function () {
            generateCards();
            await loadEventsFromFirebase();
        };
    </script>
</head>

<body>
    <div id="eventLog">
        <div id="eventLogActions">
            <button onclick="copyAllEvents()">複製所有事件</button>
        </div>
        <div id="eventLogContent"></div>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="搜尋Boss...">
    </div>
    <div class="page-title">
        <h1>哈娜RO Boss計時器</h1>
    </div>
    <div class="overlay" id="overlay"></div>
    <div class="input-time-dialog" id="timeDialog">
        <h3 id="dialogBossName"></h3>
        <input type="datetime-local" id="dialogTimeInput">
        <div class="dialog-buttons">
            <button onclick="confirmCustomTime()">確認</button>
            <button onclick="closeTimeDialog()">取消</button>
        </div>
    </div>
    <div class="input-time-dialog" id="countdownDialog">
        <h3 id="countdownDialogBossName"></h3>
        <label for="countdownInput">輸入距離重生的時間(分鐘):</label>
        <input type="number" id="countdownInput" min="1" value="30">
        <div class="dialog-buttons">
            <button onclick="confirmCountdown()">確認</button>
            <button onclick="closeCountdownDialog()">取消</button>
        </div>
    </div>

    <div class="container">
        <div class="mvp-section">
            <div class="category-title">MVP</div>
            <div class="cards-container">
                <!-- MVP卡片將在這裡生成 -->
            </div>
        </div>

        <div class="poring-section">
            <div class="category-title">波利家族</div>
            <div class="cards-container">
                <!-- 波利家族卡片將在這裡生成 -->
            </div>
        </div>
    </div>
</body>

</html>